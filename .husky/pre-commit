#!/bin/sh

echo "üîç Running pre-commit checks..."
echo ""

# 1. Run lint-staged (Biome on staged files)
echo "‚ö° Running Biome on staged files..."
bun run lint-staged || {
  echo "‚ùå Biome checks failed. Please fix the issues above."
  exit 1
}

# 2. Run TypeScript type checking
echo ""
echo "üîç Running TypeScript type check..."
bun run type-check || {
  echo "‚ùå TypeScript type check failed. Please fix the type errors above."
  exit 1
}

# 3. Check for console.log statements (warning only)
echo ""
echo "üîé Checking for console statements..."
if git diff --cached --name-only | grep -E '\.(ts|tsx|js|jsx)$' | xargs grep -n "console\.\(log\|debug\|info\)" 2>/dev/null; then
  echo "‚ö†Ô∏è  Warning: Found console statements in staged files."
  echo "   Consider removing them before committing to production."
  echo ""
fi

# 4. Check for debugging statements (warning only)
if git diff --cached --name-only | grep -E '\.(ts|tsx|js|jsx)$' | xargs grep -n "debugger" 2>/dev/null; then
  echo "‚ö†Ô∏è  Warning: Found debugger statements in staged files."
  echo "   Please remove them before committing."
  echo ""
fi

# 5. Validate JSON files
echo "üìã Validating JSON files..."
for file in $(git diff --cached --name-only | grep '\.json$'); do
  if [ -f "$file" ]; then
    if ! jq empty "$file" 2>/dev/null; then
      echo "‚ùå Invalid JSON in $file"
      exit 1
    fi
  fi
done

echo ""
echo "‚úÖ All pre-commit checks passed!"
echo ""
